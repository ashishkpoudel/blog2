<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Sapiensworks | The Myth of Manual POCO Mapping Performance</title>
  <meta name="description" content="Converting tech into business advantage">
  <meta name="author" content="Mike Mogosanu">
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:description" content="In-depth technical articles for developers who want to deliver more business value"/>
<meta name="twitter:title" content="SapiensWorks -  The Myth of Manual POCO Mapping Performance"/>
<meta name="twitter:site" content="@sapiensworks"/>
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/gridlex/2.6.1/gridlex.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
 <!-- <link rel="alternate" type="application/atom+xml" title="Sapiensworks Articles" href="/feed.atom" /> -->
  <link rel="stylesheet"
  href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <link rel="stylesheet" href="/style.css">
  <script type='text/javascript' src='//platform-api.sharethis.com/js/sharethis.js#property=5a3b096e9d192f001374336b&product=sop' async='async'></script>
</head>
<body>
<header>
  <div class="grid-noGutter-middle">
    <div class="col-4_xs-12_sm-12" data-push-left="off-4_sm-0_xs-0">
      
          <h1 class="title">  <a href="/">  Sapiens Works </a> </h1>
      
      

      </div>
      
      <div class="col-3_xs-8_sm-8 text-center" data-push-left="off-1_xs-1_sm-1"><a href="https://twitter.com/sapiensworks">
        <span class="fa fa-twitter-square fa-2x"></span></a>
        <a href="https://github.com/sapiens">
        <span class="fa fa-github-square fa-2x"></span></a>
        <a href="http://stackoverflow.com/users/1017868/mikesw">
        <span class="fa fa-stack-overflow fa-2x"></span></a>
        <!-- <a href="/feed.atom">
        <span class="fa fa-rss-square fa-2x"></span></a> -->
      </div>
    
    
  </div>
  <div class="grid-middle-center-noGutter">
      <div class="col-3_xs-12_sm-12"><span class="tagline">Converting tech into business advantage</span></div>
    
    </div>
    
        <nav class="grid-center-noGutter-middle main-menu">
            
            <a href="/tags.html" class="col-1_xs-3_sm-3">
              <span>Topics</span>
            </a>
            <a href="/about.html" class="col-1_xs-3_sm-3">
              <span>About</span>
            </a>
            
         
            
          </nav>

    
    

 
  

  


  
</header>
<main>



 <article>
    <header>
      <h1>The Myth of Manual POCO Mapping Performance</h1>
      <div class="article-meta">
      <span>published on &nbsp; <b>02 March 2016</b></span> in <a href="/tags.html#.net">.net</a>
    </div>
    </header>
  <div class="post">
 
<p>We are in 2016 and I still see developers proud that they're using Ado.Net and writing all that boring mapping code because &quot;it's faster&quot; and they want maximum performance. Well, the phrase &quot;stealing from your employer&quot; comes to mind and in this post I'm going to tell you why.</p>
<p>As the author of an object mapper a.ka. micro-ORM called <a href="https://github.com/sapiens/SqlFu">SqlFu</a>, for version 3 I've decided to change how I do the benchmarks. In previous versions, I've taken the easy way and benchmarked <em>whole queries</em> but this meant I also benchmarked the server configuration and ado.net performance. So, I wanted to test <strong>only</strong> the maping part from a <code>DbDataReader</code> to a POCO. This way, I could measure exactly the differences between manual mapping and code generated mapping.</p>
<p>The results were pretty much what I've expect them to be:</p>
<ul>
<li>manualy mapping to a POCO is between 80-100%+ faster than code generated</li>
<li>manualy mapping to an anonymous object (projection) is similar to the previous case</li>
<li>manualy mapping to dynamic is ~50% <strong>slower</strong> than code generated.</li>
</ul>
<p>Yes, it's <em>faster</em> to use SqlFu to map to dynamic, but that's not the point. In fairness, when doing dynamic mappings, we're cheating a bit, by using specially crafted objects.However, the interested part wasn't this. The interesting part was transforming the relative numbers to absolute numbers.</p>
<p>Sure, manually mappings are 2x faster but you see, it's the difference between 4 microseconds and 8 microseconds. Let me put that into perspecitve: assuming you have a 1 ms query, which is a <em>very fast</em> query, the performance gain you get by doing things manually is .... 0.4%. For a 1 ms query. Let that sink in for a bit.</p>
<p>You're spending at least 30 seconds (that's 30 000 000 microseconds) writing boring, repetitive and error prone code for a 0.4% performance gain (and that's when you're query is already fast). Sure, you might say that &quot;every microsecond counts&quot; but if you need <em>that</em> kind of performance, I'm afraid you've chosen the wrong platform to start with. .Net is fast, but in a scenario where <em>every</em> microsecond matters, carefully written C code is much better.</p>
<p>Thing is, if you have slow queries, then manually object mapping should be last on your optimizations list. Ensure the query is good, the server is well configured, the network has low latency etc. The 0.4% impact the code generated mapping has is simply <strong>insignificant</strong>. You're wasting time(money) and maintainability for an optimization that doesn't really matter in the big picture. And you should always <em>properly</em> benchmark things to assess if it's worth spending time for 'optimizations'.</p>
<p>In 2016, the only excuse you have to use Ado.Net directly is that you're building your own (micro)ORM. For the other use cases, you're just wasting time and money. And every time you're tempted to map to POCOs manually, ask yourself why StackOverflow, which is <em>obssessed</em> with performance, prefers to use an object mapper. After all, the main and unique feature of dapper.net is speed. Why didn't they go with manual mapping, after all, even in their (old and kinda flawed and obsolete) benchmarks manual is still faster.</p>

 </div>
 <footer>
   <div class="sharethis-inline-share-buttons"></div>
 <a class="previous" href="/post/2016/03/01/password-hashing-dot-net.html">&laquo; Previous</a> 
 <a class="next" href="/post/2016/03/19/cqs-api-client-with-aurelia.html">Next &raquo;</a>    
 </footer>
  </article>;

  <section id="comments">
  
      <div class="comments">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
      
            var disqus_shortname = 'sapiensworks';
      
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
      
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
      
        </section>
</main>
<footer>
    © 2018 SapiensWorks.com 
</footer>
<script>hljs.initHighlightingOnLoad();</script>
<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-2037614-18', 'auto');
		ga('send', 'pageview', {
		  'page': '/',
		  'title': ''
		});
	</script>
	<!-- End Google Analytics -->
</body>
</html>